# Example Redis/Valkey ACL file for RomM + EmulatorJS-SFU
#
# Usage:
#   1) Copy this file to `users.acl` (same folder).
#   2) Replace the CHANGEME_* passwords.
#   3) Mount it into the valkey/redis container and start with `--aclfile`.
#
# Notes:
# - This disables the `default` user so every client MUST authenticate.
# - Keep the passwords here in sync with your container env vars.
# - The `romm` user is intentionally broad (admin) because RomM uses Redis for
#   sessions, caching, and background tasks.
# - The `sfu` user is restricted to the `sfu:*` keyspace and a small set of
#   commands needed to validate and consume `sfu:auth:jti:*` tokens.

# Disable unauthenticated access.
user default off

# RomM backend / workers (admin privileges).
# Set these env vars in the RomM container:
#   REDIS_USERNAME=romm
#   REDIS_PASSWORD=<CHANGEME_ROMM_REDIS_PASSWORD>
# Note: RQ uses Redis Pub/Sub channels (e.g. `rq:pubsub:*`). In Redis ACL, key
# patterns (`~`) do NOT grant channel access; channels use `&` patterns.
user romm on >CHANGEME_ROMM_REDIS_PASSWORD ~* &* +@all

# EmulatorJS-SFU server (least privilege).
# Set these env vars in the SFU server:
#   SFU_AUTH_REDIS_URL=redis://sfu:<CHANGEME_SFU_REDIS_PASSWORD>@<host>:6379/0
#   ROMM_AUTH_SECRET_KEY=<same value as RomM>
#
# Commands allowed are those typically needed for:
# - verifying `sfu:auth:jti:<jti>` allowlist hashes
# - creating a one-time "used" marker key
# - Lua script execution used to do the above atomically
user sfu on >CHANGEME_SFU_REDIS_PASSWORD ~sfu:* \
  -@all \
  +ping \
  +get +set +setnx +del +exists \
  +expire +ttl +pttl \
  +hget +hgetall +hexists \
  +eval +evalsha
